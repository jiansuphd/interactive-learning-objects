<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBS 514: Visual Ethics Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- UTK Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        hbsGrey: '#58595b',
                        hbsOrange: '#ff8200',
                        alertRed: '#ef4444',
                        safeGreen: '#10b981',
                        canvas: '#f9fafb'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Georgia', 'serif']
                    }
                }
            }
        }
    </script>
    <style>
        .chart-wrapper { height: 350px; width: 100%; position: relative; }
        input[type=range] { cursor: pointer; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-canvas text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-hbsGrey text-white p-4 shadow-md z-10 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-3">
            <div class="text-3xl">⚖️</div>
            <div>
                <h1 class="text-xl font-bold text-hbsOrange tracking-wide leading-tight">Visual Ethics Lab</h1>
                <p class="text-xs text-white/60">HBS 514: How to (Not) Lie with Data</p>
            </div>
        </div>
        <div class="text-sm font-mono bg-black/20 px-3 py-1 rounded text-white/80 hidden md:block">
            Module 4: Design & Integrity
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col z-10 hidden md:flex shrink-0">
            <div class="p-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Case Studies</h3>
                <nav class="space-y-2">
                    <button onclick="loadCase('axis')" id="btn-axis" class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold bg-gray-100 border-l-4 border-hbsOrange text-hbsGrey transition hover:bg-gray-50">
                        1. The Truncated Axis
                    </button>
                    <button onclick="loadCase('map')" id="btn-map" class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-gray-500 border-l-4 border-transparent hover:bg-gray-50 hover:text-hbsGrey transition">
                        2. The Population Map
                    </button>
                    <button onclick="loadCase('cherry')" id="btn-cherry" class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-gray-500 border-l-4 border-transparent hover:bg-gray-50 hover:text-hbsGrey transition">
                        3. Cherry Picking Dates
                    </button>
                </nav>
            </div>
            <div class="mt-auto p-6 bg-gray-50 border-t border-gray-200">
                <div class="text-xs text-gray-500 mb-2">Deception Meter</div>
                <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div id="deception-bar" class="h-full bg-safeGreen transition-all duration-500" style="width: 5%"></div>
                </div>
                <div id="deception-text" class="text-right text-xs font-bold mt-1 text-safeGreen">Honest</div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 relative bg-canvas">
            
            <!-- CASE 1: AXIS TRUNCATION -->
            <section id="case-axis" class="max-w-4xl mx-auto fade-in">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Case 1: The "Budget Crisis"</h2>
                            <p class="text-gray-600 text-sm max-w-xl">
                                A city agency's budget dropped slightly from $100M to $98M (a 2% decrease). 
                                <br><strong>Your Goal:</strong> Manipulate the chart to make this look like a catastrophic collapse.
                            </p>
                        </div>
                        <div class="bg-blue-50 text-blue-800 px-4 py-2 rounded text-xs font-bold">
                            Tip: Watch the Y-Axis
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3">
                        <!-- Controls -->
                        <div class="p-6 bg-gray-50 border-r border-gray-100 space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Y-Axis Start Value ($M)</label>
                                <input type="range" id="axis-slider" min="0" max="97" value="0" class="w-full accent-hbsOrange" oninput="updateAxisChart(this.value)">
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>$0 (Honest)</span>
                                    <span>$97 (Deceptive)</span>
                                </div>
                            </div>
                            <div class="p-3 bg-white border border-gray-200 rounded text-sm text-gray-600">
                                <span class="font-bold block mb-1">Policy Implication:</span>
                                <span id="axis-feedback">At $0 baseline, the drop looks negligible. The budget is stable.</span>
                            </div>
                        </div>

                        <!-- Chart -->
                        <div class="md:col-span-2 p-6 relative">
                            <div class="chart-wrapper">
                                <canvas id="axisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CASE 2: POPULATION MAP (Simple Sim) -->
            <section id="case-map" class="max-w-4xl mx-auto hidden fade-in">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Case 2: The "Crime Wave" Map</h2>
                        <p class="text-gray-600 text-sm">
                            Maps can lie if they show raw counts instead of rates (per capita).
                            <br><strong>Your Goal:</strong> Toggle between Raw Counts and Rates to see how the story changes.
                        </p>
                    </div>

                    <div class="p-8 flex flex-col items-center gap-6">
                        <div class="flex bg-gray-100 p-1 rounded-lg">
                            <button onclick="toggleMap('count')" id="btn-map-count" class="px-6 py-2 rounded-md text-sm font-bold bg-white shadow text-hbsOrange transition">Raw Counts (Total Crime)</button>
                            <button onclick="toggleMap('rate')" id="btn-map-rate" class="px-6 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition">Per Capita Rate</button>
                        </div>

                        <!-- Simulated Map Visual -->
                        <div class="relative w-full max-w-lg aspect-video bg-gray-200 rounded-xl overflow-hidden border-2 border-gray-300 flex items-center justify-center group">
                            <!-- Simulated Cities -->
                            <div id="city-big" class="absolute top-1/3 left-1/3 w-24 h-24 rounded-full bg-red-600 opacity-90 flex items-center justify-center text-white font-bold shadow-lg transition-all duration-500">Big City</div>
                            <div id="city-small" class="absolute bottom-1/4 right-1/4 w-8 h-8 rounded-full bg-red-200 opacity-90 flex items-center justify-center text-xs text-gray-600 font-bold shadow-sm transition-all duration-500">Rural</div>
                            
                            <div class="absolute bottom-2 left-2 bg-white/90 p-2 rounded text-xs">
                                <strong>Legend:</strong> <span id="map-legend-text">Total Crimes</span>
                            </div>
                        </div>

                        <div id="map-feedback" class="text-center max-w-md text-sm text-gray-600 bg-red-50 p-4 rounded border border-red-100">
                            <strong>The Lie:</strong> This is basically just a map of where people live. Big cities always have more total crime because they have more people!
                        </div>
                    </div>
                </div>
            </section>

            <!-- CASE 3: CHERRY PICKING -->
            <section id="case-cherry" class="max-w-4xl mx-auto hidden fade-in">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Case 3: Cherry Picking the Trend</h2>
                        <p class="text-gray-600 text-sm">
                            The economy fluctuates. By picking specific start and end dates, you can fabricate a trend.
                            <br><strong>Your Goal:</strong> Adjust the time window to force a "Positive" or "Negative" narrative.
                        </p>
                    </div>

                    <div class="p-6">
                        <div class="chart-wrapper h-64">
                            <canvas id="cherryChart"></canvas>
                        </div>
                        
                        <div class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <div class="flex justify-between text-xs font-bold text-gray-500 uppercase mb-2">
                                <span>Show Full History (Honest)</span>
                                <span>Zoom to Recent Dip (Misleading)</span>
                            </div>
                            <input type="range" id="cherry-slider" min="0" max="7" value="0" class="w-full accent-hbsOrange" oninput="updateCherryChart(this.value)">
                            <div class="mt-2 text-center text-sm font-bold text-hbsGrey" id="cherry-feedback">Showing: Full 10-Year Trend (Overall Growth)</div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- Navigation ---
        function loadCase(caseId) {
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('case-' + caseId);
            target.classList.remove('hidden');
            target.classList.remove('fade-in');
            void target.offsetWidth;
            target.classList.add('fade-in');

            // Sidebar Styling
            document.querySelectorAll('aside nav button').forEach(btn => {
                btn.classList.remove('bg-gray-100', 'border-hbsOrange', 'text-hbsGrey');
                btn.classList.add('text-gray-500', 'border-transparent');
            });
            const activeBtn = document.getElementById('btn-' + caseId);
            activeBtn.classList.add('bg-gray-100', 'border-hbsOrange', 'text-hbsGrey');
            activeBtn.classList.remove('text-gray-500', 'border-transparent');
        }

        // --- Deception Meter Logic ---
        function updateMeter(val) {
            // val 0 to 100
            const bar = document.getElementById('deception-bar');
            const text = document.getElementById('deception-text');
            
            bar.style.width = val + "%";
            
            if(val < 30) {
                bar.className = "h-full bg-safeGreen transition-all duration-500";
                text.className = "text-right text-xs font-bold mt-1 text-safeGreen";
                text.innerText = "Honest Representation";
            } else if (val < 70) {
                bar.className = "h-full bg-yellow-500 transition-all duration-500";
                text.className = "text-right text-xs font-bold mt-1 text-yellow-600";
                text.innerText = "Questionable Framing";
            } else {
                bar.className = "h-full bg-alertRed transition-all duration-500";
                text.className = "text-right text-xs font-bold mt-1 text-alertRed";
                text.innerText = "DECEPTIVE / UNETHICAL";
            }
        }

        // --- Case 1: Axis Chart ---
        let axisChart;
        function initAxisChart() {
            const ctx = document.getElementById('axisChart').getContext('2d');
            axisChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024'],
                    datasets: [{
                        label: 'Annual Budget ($M)',
                        data: [100, 99.5, 99.0, 98.5, 98.0],
                        borderColor: '#58595b',
                        backgroundColor: '#ff8200',
                        borderWidth: 4,
                        pointRadius: 6,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 102 }
                    },
                    plugins: { legend: {display: false} }
                }
            });
        }

        function updateAxisChart(val) {
            // Update Scale
            axisChart.options.scales.y.min = parseInt(val);
            axisChart.update();

            // Update Feedback
            const feedback = document.getElementById('axis-feedback');
            const intVal = parseInt(val);
            
            // Update Deception Meter based on how truncated the axis is
            // 0 = honest (0% meter), 97 = deceptive (100% meter)
            const meterVal = (intVal / 97) * 100;
            updateMeter(meterVal);

            if(intVal < 20) {
                feedback.innerText = "At near-zero baseline, the drop looks negligible. Accurate context.";
                feedback.parentElement.className = "p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800";
            } else if (intVal < 80) {
                feedback.innerText = "Truncating the axis begins to exaggerate the slope. Be careful.";
                feedback.parentElement.className = "p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800";
            } else {
                feedback.innerText = "CRISIS MODE! By starting the axis at $" + intVal + "M, a tiny 2% drop looks like a total collapse.";
                feedback.parentElement.className = "p-3 bg-red-50 border border-red-200 rounded text-sm text-red-800";
            }
        }

        // --- Case 2: Map Logic ---
        function toggleMap(mode) {
            const btnCount = document.getElementById('btn-map-count');
            const btnRate = document.getElementById('btn-map-rate');
            const bigCity = document.getElementById('city-big');
            const smallCity = document.getElementById('city-small');
            const legend = document.getElementById('map-legend-text');
            const feedback = document.getElementById('map-feedback');

            if(mode === 'count') {
                // Reset Buttons
                btnCount.className = "px-6 py-2 rounded-md text-sm font-bold bg-white shadow text-hbsOrange transition";
                btnRate.className = "px-6 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition";
                
                // Visuals (Big City is RED, Small is pale)
                bigCity.className = "absolute top-1/3 left-1/3 w-24 h-24 rounded-full bg-red-600 opacity-90 flex items-center justify-center text-white font-bold shadow-lg transition-all duration-500";
                smallCity.className = "absolute bottom-1/4 right-1/4 w-8 h-8 rounded-full bg-red-200 opacity-90 flex items-center justify-center text-xs text-gray-600 font-bold shadow-sm transition-all duration-500";
                
                legend.innerText = "Total Crimes";
                feedback.innerHTML = "<strong>The Lie:</strong> This is just a population map. Big cities have more people, so they have more total crime. It tells us nothing about safety.";
                feedback.className = "text-center max-w-md text-sm text-gray-600 bg-red-50 p-4 rounded border border-red-100";
                updateMeter(90); // Deceptive
            } else {
                // Rate Mode
                btnRate.className = "px-6 py-2 rounded-md text-sm font-bold bg-white shadow text-hbsOrange transition";
                btnCount.className = "px-6 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition";

                // Visuals (Big City pale, Small City RED - showing rate)
                bigCity.className = "absolute top-1/3 left-1/3 w-24 h-24 rounded-full bg-red-200 opacity-90 flex items-center justify-center text-sm text-gray-600 font-bold shadow-sm transition-all duration-500";
                smallCity.className = "absolute bottom-1/4 right-1/4 w-8 h-8 rounded-full bg-red-600 opacity-90 flex items-center justify-center text-white text-xs font-bold shadow-lg transition-all duration-500";

                legend.innerText = "Crimes per 1,000 People";
                feedback.innerHTML = "<strong>The Insight:</strong> When adjusted for population, the Rural area actually has a higher <em>rate</em> of crime. This is the policy-relevant truth.";
                feedback.className = "text-center max-w-md text-sm text-gray-600 bg-green-50 p-4 rounded border border-green-100";
                updateMeter(10); // Honest
            }
        }

        // --- Case 3: Cherry Picking ---
        let cherryChart;
        // Full Data: A generally upward trend with a dip at the end
        const fullLabels = ['2015','2016','2017','2018','2019','2020','2021','2022','2023','2024'];
        const fullData = [10, 12, 15, 14, 18, 22, 25, 28, 24, 22]; // Generally up, but 22->24 is a dip

        function initCherryChart() {
            const ctx = document.getElementById('cherryChart').getContext('2d');
            cherryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: fullLabels,
                    datasets: [{
                        label: 'Economic Index',
                        data: fullData,
                        backgroundColor: (ctx) => {
                            // Dynamic color based on value?
                            return '#ff8200'; 
                        },
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 30 } },
                    plugins: { legend: {display: false} }
                }
            });
        }

        function updateCherryChart(val) {
            // val 0 (full data) to 7 (last 3 years only)
            const startIndex = parseInt(val); 
            
            // Slice data
            const newLabels = fullLabels.slice(startIndex);
            const newData = fullData.slice(startIndex);

            cherryChart.data.labels = newLabels;
            cherryChart.data.datasets[0].data = newData;
            cherryChart.update();

            // Update Meter & Text
            const feedback = document.getElementById('cherry-feedback');
            
            // Calculate deception based on how much data is hidden
            const meterVal = (startIndex / 7) * 100;
            updateMeter(meterVal);

            if (startIndex === 0) {
                feedback.innerText = "Showing: Full 10-Year Trend. The context shows overall strong growth despite a recent dip.";
                feedback.className = "mt-2 text-center text-sm font-bold text-safeGreen";
            } else if (startIndex < 5) {
                feedback.innerText = "Showing: Partial History. You are hiding the early context.";
                feedback.className = "mt-2 text-center text-sm font-bold text-yellow-600";
            } else {
                feedback.innerText = "Showing: Only Recent Years. You artificially created a 'Crash' narrative by hiding the long-term growth.";
                feedback.className = "mt-2 text-center text-sm font-bold text-alertRed";
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            initAxisChart();
            initCherryChart();
        });

    </script>
</body>
</html>